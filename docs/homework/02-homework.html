<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Alec L. Robitaille">
<meta name="dcterms.date" content="2023-02-05">
<title>Statistical Rethinking colearning 2023 - Homework 02</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Homework 02</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Statistical Rethinking colearning 2023</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle sidebar-tool" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">Home</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../homework/00-homework-listing.html" class="sidebar-item-text sidebar-link">Homework</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../homework/01-homework.html" class="sidebar-item-text sidebar-link">Homework 01</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../homework/02-homework.html" class="sidebar-item-text sidebar-link active">Homework 02</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../targets.html" class="sidebar-item-text sidebar-link">_targets.R</a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../notes/00-notes-listing.html" class="sidebar-item-text sidebar-link">Notes</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/01-notes.html" class="sidebar-item-text sidebar-link">Lecture 01</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/02-notes.html" class="sidebar-item-text sidebar-link">Lecture 02</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/03-notes.html" class="sidebar-item-text sidebar-link">Lecture 03</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/04-notes.html" class="sidebar-item-text sidebar-link">Lecture 04</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/05-notes.html" class="sidebar-item-text sidebar-link">Lecture 05</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/09-notes.html" class="sidebar-item-text sidebar-link">Lecture 09</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/10-notes.html" class="sidebar-item-text sidebar-link">Lecture 10</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/11-notes.html" class="sidebar-item-text sidebar-link">Lecture 11</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/12-notes.html" class="sidebar-item-text sidebar-link">Lecture 12</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/13-notes.html" class="sidebar-item-text sidebar-link">Lecture 13</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/14-notes.html" class="sidebar-item-text sidebar-link">Lecture 14</a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#question-1" id="toc-question-1" class="nav-link active" data-scroll-target="#question-1">Question 1</a></li>
  <li><a href="#question-2" id="toc-question-2" class="nav-link" data-scroll-target="#question-2">Question 2</a></li>
  <li><a href="#question-3" id="toc-question-3" class="nav-link" data-scroll-target="#question-3">Question 3</a></li>
  <li><a href="#question-4---optional-challenge" id="toc-question-4---optional-challenge" class="nav-link" data-scroll-target="#question-4---optional-challenge">Question 4 - optional challenge</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title d-none d-lg-block">Homework 02</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Alec L. Robitaille </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 5, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header><div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">'R/packages.R'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="question-1" class="level2"><h2 class="anchored" data-anchor-id="question-1">Question 1</h2>
<blockquote class="blockquote">
<p>From the Howell1 dataset, consider only the people younger than 13 years old. Estimate the causal association between age and weight. Assume that age influences weight through two paths. First, age influences height, and height influences weight. Second, age directly influences weight through age-related changes in muscle growth and body proportions.</p>
</blockquote>
<blockquote class="blockquote">
<p>Draw the DAG that represents these causal relationships. And then write a generative simulation that takes age as an input and simulates height and weight, obeying the relationships in the DAG.</p>
</blockquote>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'H'</span>, <span class="st">'A'</span>, <span class="st">'W'</span><span class="op">)</span>,</span>
<span>    x <span class="op">=</span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,    <span class="fl">1</span>,   <span class="fl">2</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,    <span class="fl">1</span>,   <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">dagify</span><span class="op">(</span></span>
<span>    <span class="va">W</span> <span class="op">~</span> <span class="va">H</span> <span class="op">+</span> <span class="va">A</span>,</span>
<span>    <span class="va">H</span> <span class="op">~</span> <span class="va">A</span>,</span>
<span>  coords <span class="op">=</span> <span class="va">coords</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">ggdag</span><span class="op">(</span>seed <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_dag</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-homework_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Recall: https://speakerdeck.com/rmcelreath/statistical-rethinking-2023-lecture-04?slide=22</span></span>
<span></span>
<span><span class="co"># Set number of individuals</span></span>
<span><span class="va">n_individuals</span> <span class="op">&lt;-</span> <span class="fl">1e3</span></span>
<span></span>
<span><span class="co"># Some numbers to guide the simulation</span></span>
<span><span class="co"># 0 years: 50cm, 3.5kg</span></span>
<span><span class="co"># 12 years: 150cm, 45kg</span></span>
<span><span class="va">simulate_heights</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">beta_age_height</span> <span class="op">&lt;-</span> <span class="fl">7</span></span>
<span>    <span class="va">beta_height_weight</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span>    <span class="va">beta_age_weight</span> <span class="op">&lt;-</span> <span class="fl">2.5</span></span>
<span>    </span>
<span>    <span class="va">age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0</span>, <span class="fl">12</span><span class="op">)</span></span>
<span>    <span class="va">height</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">beta_age_height</span> <span class="op">*</span> <span class="va">age</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="va">weight</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span></span>
<span>        <span class="va">n</span>, </span>
<span>        <span class="op">(</span><span class="va">beta_height_weight</span> <span class="op">*</span> <span class="va">height</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">beta_age_weight</span> <span class="op">*</span> <span class="va">age</span><span class="op">)</span>, </span>
<span>        <span class="fl">2</span></span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu">data.table</span><span class="op">(</span></span>
<span>        age <span class="op">=</span> <span class="va">age</span>,</span>
<span>        height <span class="op">=</span> <span class="va">height</span>,</span>
<span>        weight <span class="op">=</span> <span class="va">weight</span></span>
<span>    <span class="op">)</span><span class="op">)</span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu">simulate_heights</span><span class="op">(</span><span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">DT</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">age</span>, <span class="va">weight</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-homework_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section><section id="question-2" class="level2"><h2 class="anchored" data-anchor-id="question-2">Question 2</h2>
<blockquote class="blockquote">
<p>Use a linear regression to estimate the total causal effect of each year of growth on weight.</p>
</blockquote>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Simulate to determine appropriate priors</span></span>
<span><span class="co"># Here just expecting a model defined for W ~ A, with alpha + beta_age * age</span></span>
<span><span class="va">simulate_weights</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">mean_alpha</span>, <span class="va">sd_alpha</span>, <span class="va">mean_age</span>, <span class="va">sd_age</span>, <span class="va">sigma_rate</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0</span>, <span class="fl">12</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">mean_alpha</span>, <span class="va">sd_alpha</span><span class="op">)</span></span>
<span>    <span class="va">beta_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">mean_age</span>, <span class="va">sd_age</span><span class="op">)</span></span>
<span>    <span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">sigma_rate</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">weight</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">beta_age</span> <span class="op">*</span> <span class="va">age</span>, <span class="va">sigma</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu">data.table</span><span class="op">(</span></span>
<span>        age <span class="op">=</span> <span class="va">age</span>,</span>
<span>        weight <span class="op">=</span> <span class="va">weight</span></span>
<span>    <span class="op">)</span><span class="op">)</span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="fu">simulate_weights</span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="fl">1e3</span>, </span>
<span>    mean_alpha <span class="op">=</span> <span class="fl">4</span>, </span>
<span>    sd_alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    mean_age <span class="op">=</span> <span class="fl">4</span>, </span>
<span>    sd_age <span class="op">=</span> <span class="fl">1</span>, </span>
<span>    sigma_rate <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">age</span>, <span class="va">weight</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-homework_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">'R/data_Howell1.R'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># height: Height in cm</span></span>
<span><span class="co"># weight: Weight in kg</span></span>
<span><span class="co"># age: Age in years</span></span>
<span><span class="va">DT</span> <span class="op">&lt;-</span> <span class="fu">data_Howell</span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="va">age</span> <span class="op">&lt;</span> <span class="fl">12</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page"><code>rethinking</code></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false"><code>brms</code></a></li>
</ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Model</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">quap</span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html">alist</a></span><span class="op">(</span></span>
<span>        <span class="va">weight</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">mu</span>, <span class="va">sigma</span><span class="op">)</span>,</span>
<span>        <span class="va">mu</span> <span class="op">&lt;-</span> <span class="va">alpha</span> <span class="op">+</span> <span class="va">beta_age</span> <span class="op">*</span> <span class="va">age</span>,</span>
<span>        <span class="va">alpha</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>        <span class="va">beta_age</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>        <span class="va">sigma</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">dexp</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="va">DT</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">precis</span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             mean         sd     5.5%    94.5%
alpha    6.360395 0.30637164 5.870754 6.850036
beta_age 1.479591 0.05682131 1.388780 1.570402
sigma    2.315786 0.15042059 2.075385 2.556187</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">tar_load</span><span class="op">(</span><span class="va">m_h02_q02</span><span class="op">)</span></span>
<span><span class="va">m_h02_q02</span><span class="op">$</span><span class="va">formula</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>weight ~ age </code></pre>
</div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m_h02_q02</span><span class="op">$</span><span class="va">prior</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          prior     class coef group resp dpar nlpar lb ub       source
   normal(4, 1)         b                                          user
   normal(4, 1)         b  age                             (vectorized)
 normal(4, 0.5) Intercept                                          user
 exponential(1)     sigma                             0            user</code></pre>
</div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">posterior_summary</span><span class="op">(</span><span class="va">m_h02_q02</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               Estimate   Est.Error        Q2.5       Q97.5
b_Intercept    5.094576  0.70458518    3.522899    6.272208
b_age          1.320822  0.08965145    1.144587    1.499246
sigma          3.292029  0.45359263    2.589660    4.372071
lprior      -113.199889 15.07420509 -139.373660  -80.497359
lp__        -453.892842  1.29496243 -457.129260 -452.422809</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section id="question-3" class="level2"><h2 class="anchored" data-anchor-id="question-3">Question 3</h2>
<blockquote class="blockquote">
<p>Now suppose the causal association between age and weight might be different for boys and girls. Use a single linear regression, with a categorical variable for sex, to estimate the total causal effect of age on weight separately for boys and girls. How do girls and boys differ? Provide one or more posterior contrasts as a summary.</p>
</blockquote>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'H'</span>, <span class="st">'A'</span>, <span class="st">'W'</span>, <span class="st">'S'</span><span class="op">)</span>,</span>
<span>    x <span class="op">=</span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,    <span class="fl">1</span>,   <span class="fl">2</span>,    <span class="fl">2</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,    <span class="fl">1</span>,   <span class="fl">0</span>,    <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">dagify</span><span class="op">(</span></span>
<span>    <span class="va">W</span> <span class="op">~</span> <span class="va">H</span> <span class="op">+</span> <span class="va">A</span> <span class="op">+</span> <span class="va">S</span>,</span>
<span>    <span class="va">H</span> <span class="op">~</span> <span class="va">A</span> <span class="op">+</span> <span class="va">S</span>,</span>
<span>  coords <span class="op">=</span> <span class="va">coords</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">ggdag</span><span class="op">(</span>seed <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_dag</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-homework_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="384"></p>
</div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Group index for sex</span></span>
<span><span class="va">DT</span><span class="op">[</span>, <span class="va">sex</span> <span class="op">:=</span> <span class="va">.GRP</span>, by <span class="op">=</span> <span class="va">male</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Set up key of sex factor levels and labels</span></span>
<span><span class="va">key</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">DT</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">sex</span>, sex_char <span class="op">=</span> <span class="fu">fifelse</span><span class="op">(</span><span class="va">male</span> <span class="op">==</span> <span class="fl">1</span>, <span class="st">'male'</span>, <span class="st">'female'</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true"><code>rethinking</code></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false"><code>brms</code></a></li>
</ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Model</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">quap</span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html">alist</a></span><span class="op">(</span></span>
<span>        <span class="va">weight</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">mu</span>, <span class="va">sigma</span><span class="op">)</span>,</span>
<span>        <span class="va">mu</span> <span class="op">&lt;-</span> <span class="va">alpha</span><span class="op">[</span><span class="va">sex</span><span class="op">]</span> <span class="op">+</span> <span class="va">beta_age</span><span class="op">[</span><span class="va">sex</span><span class="op">]</span> <span class="op">*</span> <span class="va">age</span>,</span>
<span>        <span class="va">alpha</span><span class="op">[</span><span class="va">sex</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>        <span class="va">beta_age</span><span class="op">[</span><span class="va">sex</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>        <span class="va">sigma</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">dexp</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="va">DT</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up the options for predictions</span></span>
<span><span class="va">DT_pred</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="op">(</span></span>
<span>    age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">12</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">[</span>, <span class="va">variable</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'V'</span>, <span class="va">.I</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span></span>
<span><span class="co"># Simulate where sex = 1, and where sex = 2</span></span>
<span><span class="va">sim_sex_1</span> <span class="op">&lt;-</span> <span class="fu">sim</span><span class="op">(</span><span class="va">m</span>, <span class="va">DT_pred</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">age</span>, sex <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">sim_sex_2</span> <span class="op">&lt;-</span> <span class="fu">sim</span><span class="op">(</span><span class="va">m</span>, <span class="va">DT_pred</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">age</span>, sex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Posterior of differences</span></span>
<span><span class="va">sim_diff</span> <span class="op">&lt;-</span> <span class="va">sim_sex_1</span> <span class="op">-</span> <span class="va">sim_sex_2</span></span>
<span></span>
<span><span class="co"># Melt and tidy</span></span>
<span><span class="va">melt_diff</span> <span class="op">&lt;-</span> <span class="fu">melt</span><span class="op">(</span><span class="fu">as.data.table</span><span class="op">(</span><span class="va">sim_diff</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">DT_diff</span> <span class="op">&lt;-</span> <span class="va">melt_diff</span><span class="op">[</span><span class="va">DT_pred</span>, on <span class="op">=</span> <span class="st">'variable'</span><span class="op">]</span></span>
<span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">DT_diff</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">age</span>, <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">stat_lineribbon</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_fill_scico_d</span><span class="op">(</span></span>
<span>        direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>        palette <span class="op">=</span> <span class="st">'nuuk'</span>,</span>
<span>        end <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span></span>
<span>        y <span class="op">=</span> <span class="st">'predicted difference in weight'</span>,</span>
<span>        title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">'Posterior predicted difference in weight between'</span>,</span>
<span>                                    <span class="va">key</span><span class="op">[</span><span class="va">sex</span> <span class="op">==</span> <span class="fl">1</span>, <span class="va">sex_char</span><span class="op">]</span>, <span class="st">'and'</span>,</span>
<span>                                    <span class="va">key</span><span class="op">[</span><span class="va">sex</span> <span class="op">==</span> <span class="fl">2</span>, <span class="va">sex_char</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-homework_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Note: differences with link</span></span>
<span><span class="co"># Predict where sex = 1, and where sex = 2</span></span>
<span><span class="va">link_sex_1</span> <span class="op">&lt;-</span> <span class="fu">link</span><span class="op">(</span><span class="va">m</span>, <span class="va">DT_pred</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">age</span>, sex <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">link_sex_2</span> <span class="op">&lt;-</span> <span class="fu">link</span><span class="op">(</span><span class="va">m</span>, <span class="va">DT_pred</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">age</span>, sex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Posterior of differences</span></span>
<span><span class="va">link_diff</span> <span class="op">&lt;-</span> <span class="va">link_sex_1</span> <span class="op">-</span> <span class="va">link_sex_2</span></span>
<span></span>
<span><span class="co"># Melt and tidy</span></span>
<span><span class="va">melt_diff</span> <span class="op">&lt;-</span> <span class="fu">melt</span><span class="op">(</span><span class="fu">as.data.table</span><span class="op">(</span><span class="va">link_diff</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">DT_diff_link</span> <span class="op">&lt;-</span> <span class="va">melt_diff</span><span class="op">[</span><span class="va">DT_pred</span>, on <span class="op">=</span> <span class="st">'variable'</span><span class="op">]</span></span>
<span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">DT_diff_link</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">age</span>, <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">stat_lineribbon</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_fill_scico_d</span><span class="op">(</span></span>
<span>        direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>        palette <span class="op">=</span> <span class="st">'nuuk'</span>,</span>
<span>        end <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span></span>
<span>        y <span class="op">=</span> <span class="st">'predicted difference in weight'</span>,</span>
<span>        title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">'Predicted difference in weight between'</span>,</span>
<span>                                    <span class="va">key</span><span class="op">[</span><span class="va">sex</span> <span class="op">==</span> <span class="fl">1</span>, <span class="va">sex_char</span><span class="op">]</span>, <span class="st">'and'</span>,</span>
<span>                                    <span class="va">key</span><span class="op">[</span><span class="va">sex</span> <span class="op">==</span> <span class="fl">2</span>, <span class="va">sex_char</span><span class="op">]</span><span class="op">)</span>,</span>
<span>        subtitle <span class="op">=</span> <span class="st">'Note: uncertainty is not incorporated into predictions with "link"'</span></span>
<span>    <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-homework_files/figure-html/unnamed-chunk-12-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Model</span></span>
<span><span class="fu">tar_load</span><span class="op">(</span><span class="va">m_h02_q03</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m_h02_q03</span><span class="op">$</span><span class="va">formula</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>weight ~ age + sex </code></pre>
</div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m_h02_q03</span><span class="op">$</span><span class="va">prior</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          prior     class coef group resp dpar nlpar lb ub       source
   normal(4, 1)         b                                          user
   normal(4, 1)         b  age                             (vectorized)
   normal(4, 1)         b  sex                             (vectorized)
 normal(4, 0.5) Intercept                                          user
 exponential(1)     sigma                             0            user</code></pre>
</div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Set up the options for predictions</span></span>
<span><span class="va">DT_pred</span> <span class="op">&lt;-</span> <span class="fu">CJ</span><span class="op">(</span></span>
<span>    age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">12</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Simulate where sex = 1, and where sex = 2</span></span>
<span><span class="va">post_pred_sex_1</span> <span class="op">&lt;-</span> <span class="fu">predicted_draws</span><span class="op">(</span><span class="va">m_h02_q03</span>, <span class="va">DT_pred</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">age</span>, sex <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">post_pred_sex_2</span> <span class="op">&lt;-</span> <span class="fu">predicted_draws</span><span class="op">(</span><span class="va">m_h02_q03</span>, <span class="va">DT_pred</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">age</span>, sex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Predicted table</span></span>
<span><span class="va">DT_diff</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="op">(</span></span>
<span>    predict_sex_1 <span class="op">=</span> <span class="va">post_pred_sex_1</span><span class="op">$</span><span class="va">.prediction</span>,</span>
<span>    predict_sex_2 <span class="op">=</span> <span class="va">post_pred_sex_2</span><span class="op">$</span><span class="va">.prediction</span>,</span>
<span>    age <span class="op">=</span> <span class="va">post_pred_sex_1</span><span class="op">$</span><span class="va">age</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Posterior of differences</span></span>
<span><span class="va">DT_diff</span><span class="op">[</span>, <span class="va">diff</span> <span class="op">:=</span> <span class="va">predict_sex_1</span> <span class="op">-</span> <span class="va">predict_sex_2</span><span class="op">]</span></span>
<span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">DT_diff</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">age</span>, <span class="va">diff</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">stat_lineribbon</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_fill_scico_d</span><span class="op">(</span>direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>                                         palette <span class="op">=</span> <span class="st">'nuuk'</span>,</span>
<span>                                         end <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span></span>
<span>        y <span class="op">=</span> <span class="st">'predicted difference in weight'</span>,</span>
<span>        title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">'Posterior predicted difference in weight between'</span>,</span>
<span>                                    <span class="va">key</span><span class="op">[</span><span class="va">sex</span> <span class="op">==</span> <span class="fl">1</span>, <span class="va">sex_char</span><span class="op">]</span>, <span class="st">'and'</span>,</span>
<span>                                    <span class="va">key</span><span class="op">[</span><span class="va">sex</span> <span class="op">==</span> <span class="fl">2</span>, <span class="va">sex_char</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-homework_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
<p>Details on the difference between <code>sim</code> and <code>link</code> are in the textbook around pages 105-110, the Overthinking box “How does link work?”, code 4.58-4.62, Rethinking box “two kinds of uncertainty”.</p>
<ul>
<li>link takes the model formula to return what the average line would predict about your new data</li>
<li>sim takes the model formula and <strong>uncertainty</strong> to return the posterior distribution of lines would predict about your new data</li>
</ul></section><section id="question-4---optional-challenge" class="level2"><h2 class="anchored" data-anchor-id="question-4---optional-challenge">Question 4 - optional challenge</h2>
<blockquote class="blockquote">
<p>The data in data(Oxboys) (rethinking package) are growth records for 26 boys measured over 9 periods. I want you to model their growth. Specifically, model the increments in growth from one period (Occasion in the data table) to the next. Each increment is simply the difference between height in one occasion and height in the previous occasion. Since none of these boys shrunk during the study, all of the growth increments are greater than zero. Estimate the posterior distribution of these increments. Constrain the distribution so it is always positive — it should not be possible for the model to think that boys can shrink from year to year. Finally compute the posterior distribution of the total growth over all 9 occasions.</p>
</blockquote>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Get data and prepare it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Oxboys</span><span class="op">)</span></span>
<span></span>
<span><span class="va">DT_ox</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="op">(</span><span class="va">Oxboys</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">setorder</span><span class="op">(</span><span class="va">DT_ox</span>, <span class="va">Occasion</span><span class="op">)</span></span>
<span><span class="fu">setnames</span><span class="op">(</span><span class="va">DT_ox</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">DT_ox</span><span class="op">)</span>, <span class="fu">make_clean_names</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">DT_ox</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">DT_ox</span><span class="op">[</span>, <span class="va">diff_height</span> <span class="op">:=</span> <span class="va">height</span> <span class="op">-</span> <span class="fu">shift</span><span class="op">(</span><span class="va">height</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">subject</span><span class="op">]</span></span>
<span><span class="va">DT_ox</span><span class="op">[</span>, <span class="va">index_occasion</span> <span class="op">:=</span> <span class="va">occasion</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span></span>
<span><span class="co"># Simulate to evaluate priors</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">sim_prior</span> <span class="op">&lt;-</span> <span class="fu">CJ</span><span class="op">(</span>occasion <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">DT_ox</span><span class="op">$</span><span class="va">occasion</span><span class="op">)</span>,</span>
<span>                                row_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq.int</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sim_prior</span><span class="op">[</span>, <span class="va">diff_height</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html">rlnorm</a></span><span class="op">(</span><span class="va">.N</span>, <span class="fl">0.1</span>, <span class="fl">0.3</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">sim_prior</span>, <span class="fu">aes</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">occasion</span><span class="op">)</span>, <span class="va">diff_height</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">stat_slab</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">'ocassion'</span>, y <span class="op">=</span> <span class="st">'difference in height (cm)'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-homework_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">quap</span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html">alist</a></span><span class="op">(</span></span>
<span>        <span class="va">diff_height</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html">dlnorm</a></span><span class="op">(</span><span class="va">mu</span>, <span class="va">sigma</span><span class="op">)</span>,</span>
<span>        <span class="va">mu</span> <span class="op">&lt;-</span> <span class="va">alpha</span><span class="op">[</span><span class="va">index_occasion</span><span class="op">]</span>,</span>
<span>        <span class="va">alpha</span><span class="op">[</span><span class="va">index_occasion</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>        <span class="va">sigma</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">dexp</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="va">DT_ox</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">diff_height</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu">precis</span><span class="op">(</span><span class="va">m</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-homework_files/figure-html/unnamed-chunk-14-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu">sim</span><span class="op">(</span><span class="va">m</span>, <span class="fu">data.table</span><span class="op">(</span>index_occasion <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq.int</a></span><span class="op">(</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Posterior distribution of total growth </span></span>
<span><span class="fu">dens</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">sims</span>, <span class="fl">1</span>, <span class="va">sum</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-homework_files/figure-html/unnamed-chunk-14-3.png" class="img-fluid" width="672"></p>
</div>
</div>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'alternate';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>